"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[905],{973:(e,t,s)=>{s.d(t,{A:()=>o});var l=s(756),n=s(1);class a extends n.N{constructor(e,t,s,l,n){super(l,n),this.publisher=void 0,this.spreadsheet=void 0,this.id=void 0,this.publisher=e,this.spreadsheet=t,this.id=s}async execute(e){const t=this.encodeLoginString(),s=(await l.Pw(this.publisher,this.spreadsheet,0,t)).value.map((e=>e.payload));e.addUpdatesForPublished(this.publisher,this.spreadsheet,s)}}const o=a},584:(e,t,s)=>{s.d(t,{A:()=>o});var l=s(756),n=s(1);class a extends n.N{constructor(e,t,s,l,n,a){super(n,a),this.publisher=void 0,this.spreadsheet=void 0,this.id=void 0,this.payload=void 0,this.publisher=e,this.spreadsheet=t,this.id=s,this.payload=l}async execute(e){const t=this.encodeLoginString();await l.Sz(this.publisher,this.spreadsheet,this.id,this.payload,t);e.addUpdatesForPublished(this.publisher,this.spreadsheet,[this.payload])}}const o=a},905:(e,t,s)=>{s.r(t),s.d(t,{default:()=>U});var l=s(43),n=s(579);const a=e=>{let{buttonLabel:t,listItems:s,selectFunction:a}=e;const[o,r]=(0,l.useState)(!1),i=(0,l.useRef)(null);return(0,n.jsxs)("div",{className:"functions-dropdown",ref:i,onBlur:e=>{var t;null!==(t=i.current)&&void 0!==t&&t.contains(e.relatedTarget)||r(!1)},children:[(0,n.jsxs)("button",{className:"dropdown-toggle function-row-boxes",onClick:()=>{r(!o)},children:[t,(0,n.jsx)("div",{className:"arrow ".concat(o?"down":"up")})]}),o&&(0,n.jsx)("div",{className:"dropdown-menu",children:s.map(((e,t)=>(0,n.jsx)("button",{className:"dropdown-item",onClick:()=>{a(e),r(!1)},children:e},t)))})]})};let o=function(e){return e.SUM="SUM",e.IF="IF",e.MIN="MIN",e.MAX="MAX",e.AVG="AVG",e.CONCAT="CONCAT",e.DEBUG="DEBUG",e.COPY="COPY",e}({});const r=e=>{let{handleCellChange:t,selectedCell:s,tableData:r}=e;const[i,d]=(0,l.useState)(null);(0,l.useEffect)((()=>{s&&d(s.getErrorMessage())}),[s,t,r]);const h=[o.SUM,o.IF,o.MIN,o.MAX,o.AVG,o.CONCAT,o.DEBUG,o.COPY];return(0,n.jsxs)("div",{className:"function-row",children:[(0,n.jsx)("div",{className:"selected-cell function-row-boxes",children:null!==s?s.getColumnAsLetter()+(s.getRow()+1):"Selected cell"}),(0,n.jsx)(a,{buttonLabel:"Functions",listItems:h,selectFunction:e=>{if(s){t(s,"="+e+"(")}}}),(0,n.jsxs)("div",{className:"function-input-wrapper",children:[i&&(0,n.jsxs)("div",{className:"error-tooltip",children:[(0,n.jsx)("p",{children:"!"}),(0,n.jsx)("div",{className:"error-message",children:i})]}),(0,n.jsx)("input",{className:"function-input function-row-boxes ".concat(i&&"activeError"),onChange:e=>t(s,e.target.value),value:null!==s?s.getFormula():""})]})]})},i=e=>{let{changeSelectedCell:t,cell:s,columnWidth:a,handleCellChange:o,handleMouseDown:r,xCoord:i,yCoord:d}=e;const[h,c]=(0,l.useState)(!1),[u,p]=(0,l.useState)(s.getValue()),m=()=>{t(s),c(!0)},g=()=>{c(!1)},C=(0,l.useCallback)((e=>{const t=e.target.value;p(t),o(s,t)}),[o,s]);return(0,l.useEffect)((()=>{p(s.getValue())}),[s]),0===i&&0===d?(0,n.jsx)("div",{className:"corner-cell"}):0===i?(0,n.jsx)("div",{className:"index-cell",children:s.getValue()}):0===d?(0,n.jsxs)("div",{className:"header-cell",style:{width:"".concat(a,"px")},children:[(0,n.jsx)("div",{className:"column-cell-text",children:s.getValue()}),(0,n.jsx)("div",{className:"resizer",onMouseDown:e=>r(i,e)})]}):h?(0,n.jsx)("input",{className:"cell",onBlur:g,onChange:C,style:{width:"".concat(a,"px")},value:u,autoFocus:!0}):(0,n.jsx)("div",{className:"cell cell-div",onClick:m,style:{width:"".concat(a,"px")},children:s.getValue()})};const d=class{constructor(e){this.value=void 0,this.value=e}setFormula(e){throw new Error("Method not implemented.")}getFormula(){throw new Error("Method not implemented.")}getRow(){throw new Error("Method not implemented.")}getColumn(){throw new Error("Method not implemented.")}getColumnAsLetter(){throw new Error("Method not implemented.")}setValue(e){throw new Error("Method not implemented.")}getSpreadSheetID(){throw new Error("Method not implemented.")}getErrorMessage(){throw new Error("Method not implemented.")}getValue(){return this.value}};function h(e,t){for(let s=0;s<e.length;s++)if(e[s]!==t[s])return!0;return!1}class c extends l.Component{constructor(e){super(e),this.state={prevColumnWidths:e.columnWidths.slice(),prevCellRow:[]}}shouldComponentUpdate(e){return!(!h(e.cellRow.map((e=>e.getValue())),this.state.prevCellRow)&&!h(e.columnWidths,this.state.prevColumnWidths))&&(this.updatePrevData(),!0)}updatePrevData(){this.setState({prevCellRow:this.props.cellRow.map((e=>e.getValue()))}),this.setState({prevColumnWidths:this.props.columnWidths.slice()})}render(){const{changeSelectedCell:e,columnWidths:t,handleCellChange:s,handleMouseDown:l,cellRow:a,rowIndex:o}=this.props,r=0!==o?[new d(String(o)),...a]:[new d(""),...a];return(0,n.jsx)("div",{className:"row ".concat(0===o?"column-row":""),children:r.map(((a,r)=>(0,n.jsx)(i,{cell:a,changeSelectedCell:e,columnWidth:t[r],handleCellChange:s,handleMouseDown:l,xCoord:r,yCoord:o},r)))})}}const u=c;var p=s(321);class m extends l.Component{constructor(e){super(e),this.handleMouseDown=(e,t)=>{t.preventDefault();const s=t.clientX,l=this.state.columnWidths[e],n=t=>{const n=l+(t.clientX-s);this.setState((t=>{const s=[...t.columnWidths];return s[e]=n>50?n:50,{columnWidths:s}}))},a=()=>{document.removeEventListener("mousemove",n),document.removeEventListener("mouseup",a)};document.addEventListener("mousemove",n),document.addEventListener("mouseup",a)},this.renderRow=e=>{let{index:t,style:s}=e;const{changeSelectedCell:l,handleCellChange:a}=this.props,{columnWidths:o}=this.state,r=this.props.tableData[t];return(0,n.jsx)("div",{style:s,children:(0,n.jsx)(u,{changeSelectedCell:l,handleCellChange:a,handleMouseDown:this.handleMouseDown,rowIndex:t,cellRow:r,columnWidths:o})},t)},this.state={columnWidths:new Array(e.tableData.length).fill(75)},this.handleMouseDown=this.handleMouseDown.bind(this)}componentDidUpdate(e){0===e.tableData.length&&this.props.tableData.length>0&&this.setState({columnWidths:new Array(this.props.tableData[0].length+1).fill(75)})}render(){var e;const{changeSelectedCell:t,handleCellChange:s,tableData:l}=this.props,{columnWidths:a}=this.state,o=this.state.columnWidths.reduce(((e,t)=>e+t),0)-30;return(0,n.jsx)("div",{children:(null===(e=l[0])||void 0===e?void 0:e.length)<401?(0,n.jsx)("div",{className:"spreadsheet-table",children:l.map(((e,l)=>(0,n.jsx)(u,{changeSelectedCell:t,handleCellChange:s,handleMouseDown:this.handleMouseDown,rowIndex:l,cellRow:e,columnWidths:a},l)))}):(0,n.jsx)("div",{className:"large-spreadsheet-table",children:(0,n.jsx)(p.t$,{disableWidth:!0,children:e=>{let{height:t}=e;return(0,n.jsx)(p.B8,{columnWidths:a,height:t,rowCount:l.length,rowHeight:22,rowRenderer:this.renderRow,tableData:l,style:{paddingBottom:"17px"},overscanRowCount:3,width:o})}})})})}}const g=m;var C=s(475);const v=e=>{let{handleUpdateSubscription:t,spreadsheet:s,updateCurrentUser:a,user:o}=e;const[r,i]=(0,l.useState)(!1);(0,l.useEffect)((()=>{s&&i(s.autoUpdatesEnabled())}),[s]);const d=o.getUserName()===(null===s||void 0===s?void 0:s.getPublisher())?"Publisher":"Editor";return(0,n.jsxs)("div",{className:"top-row",children:[(0,n.jsxs)("div",{className:"top-left-row",children:[(0,n.jsx)(C.k2,{className:"home-button buttons",to:"/",children:"Home"}),"Publisher"!==d?(0,n.jsx)("button",{className:"save-button buttons",onClick:()=>t(s),style:{display:"".concat(r?"none":"")},children:"Update Subscription"}):(0,n.jsxs)("button",{className:"save-button buttons",onClick:()=>{if(s){const e=null===s||void 0===s?void 0:s.autoUpdatesEnabled();null===s||void 0===s||s.setAutoUpdates(!e),i(!e)}},children:[r?"Disable":"Enable"," Auto Updates"]}),(0,n.jsx)("h1",{children:null===s||void 0===s?void 0:s.getSheetName().substring(0,30)})]}),(0,n.jsxs)("div",{className:"top-right-row",children:[(0,n.jsx)("p",{className:"profile",children:o.getUserName().substring(0,20)+": "+d}),(0,n.jsx)(C.k2,{className:"logout-button buttons",onClick:()=>a(null),to:"/?",children:"Logout"})]})]})},w=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"];function b(e){let t=new Array(e);for(let s=0;s<e;s++)t[s]=new d(s<26?w[s]:w[Math.floor((s-26)/26)]+w[s%26]);return t}var x=s(756),N=s(1);class S extends N.N{constructor(e,t,s,l,n,a){super(n,a),this.publisher=void 0,this.spreadsheet=void 0,this.id=void 0,this.payload=void 0,this.publisher=e,this.spreadsheet=t,this.id=s,this.payload=l}async execute(e){const t=this.encodeLoginString();await x.nV(this.publisher,this.spreadsheet,this.id,this.payload,t);e.addUpdatesForSubscription(this.publisher,this.spreadsheet,[this.payload])}}const j=S;var f=s(584),D=s(973);class M extends l.Component{constructor(e){super(e),this.state={errorMessage:"",loading:!1,tableData:[],selectedCell:null},this.handleCellChange=this.handleCellChange.bind(this),this.changeSelectedCell=this.changeSelectedCell.bind(this),this.handleUpdateSubscription=this.handleUpdateSubscription.bind(this)}async componentDidMount(){try{if(this.props.spreadsheet){var e;this.setState({loading:!0}),await this.props.controller.excecuteRequest(new D.A(this.props.spreadsheet.getPublisher(),null===(e=this.props.spreadsheet)||void 0===e?void 0:e.getSheetName(),0,this.props.user.getUserName(),this.props.user.getPassword()));const t=this.props.spreadsheet.getAllCells(),s=[b(this.props.spreadsheet.getColumns()),...t];this.setState({tableData:s,loading:!1})}else this.setState({loading:!0})}catch(t){this.setState({errorMessage:t instanceof Error?t.message:"Problem loading spreadsheet"})}}async handleCellChange(e,t){const{controller:s,spreadsheet:l,user:n}=this.props;if(e&&l){e.setValue(t);const o="$"+e.getColumnAsLetter()+(e.getRow()+1)+" "+e.getFormula();var a;if(l.getPublisher()===n.getUserName()||l.autoUpdatesEnabled())await s.excecuteRequest(new f.A(l.getPublisher(),l.getSheetName(),Number(l.getID()),o,n.getUserName(),n.getPassword()));else null===(a=this.props.spreadsheet)||void 0===a||a.addUpdate("$"+e.getColumnAsLetter()+(e.getRow()+1),e.getFormula());const r=[...this.state.tableData];this.setState({tableData:r})}}changeSelectedCell(e){this.setState({selectedCell:e})}async handleUpdateSubscription(e){const{user:t}=this.props;if(e&&t)try{let s=e.getUpdates();const l=Object.entries(s).map((e=>{let[t,s]=e;return"".concat(t," ").concat(s)})).join("\n");await this.props.controller.excecuteRequest(new j(t.getUserName(),e.getSheetName(),Number(e.getID()),l,t.getUserName(),t.getPassword()))}catch(s){this.setState({errorMessage:s instanceof Error?s.message:"Problem sending subscription update"})}}render(){const{errorMessage:e,loading:t,selectedCell:s,tableData:l}=this.state;return(0,n.jsxs)("div",{className:"spreadsheet-editor-page",children:[(0,n.jsx)(v,{handleUpdateSubscription:this.handleUpdateSubscription,spreadsheet:this.props.spreadsheet,user:this.props.user,updateCurrentUser:this.props.updateCurrentUser}),(0,n.jsx)(r,{handleCellChange:this.handleCellChange,selectedCell:s,tableData:l}),t?(0,n.jsx)("div",{children:"Loading..."}):(0,n.jsx)(n.Fragment,{children:""!==e?(0,n.jsx)("div",{className:"error",children:e}):(0,n.jsx)(g,{changeSelectedCell:this.changeSelectedCell,handleCellChange:this.handleCellChange,tableData:l})})]})}}const U=M}}]);
//# sourceMappingURL=905.cc4d3f90.chunk.js.map